<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session b50ed78b-7864-4c92-8488-877e5e779aaa (2026-01-01 23:53Z) -->

# User card eligibility without start command (2026-01-01 23:53Z)

_**User (2026-01-01 22:21Z)**_

Are users allowed to get cards even if they never entered `/start` in the chat with the bot?

---

_**Agent (model default, mode Ask)**_



---


Checking how `/start` is handled and whether card distribution requires it.


---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "start command handler registration" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `handlers/player.py` | L69 |
| `handlers/player.py` | L13-69 |
| `main.py` | L89 |
| `main.py` | L18-93 |
| `.cursor/rules/derived-cursor-rules.mdc` | L108-140 |
| `README.md` | L19-63 |
| `.cursor/rules/derived-cursor-rules.mdc` | L167-195 |
| `handlers/admin.py` | L41 |
| `handlers/admin.py` | L49-113 |
| `.cursor/rules/derived-cursor-rules.mdc` | L48-83 |
| `handlers/__init__.py` | L |
| `middlewares/logger.py` | L15-81 |
| `services/scheduler.py` | L16-225 |
| `handlers/admin_autocard.py` | L47 |
| `main.py` | L23-93 |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "how are cards given to users or distributed" • **14** results</summary>
            
| File | Lines |
|------|-------|
| `handlers/drops.py` | L94-241 |
| `database/models.py` | L40-114 |
| `handlers/admin_autocard.py` | L206-309 |
| `.cursor/rules/derived-cursor-rules.mdc` | L108-140 |
| `services/scheduler.py` | L16-225 |
| `handlers/drops.py` | L25-241 |
| `handlers/drops.py` | L142-241 |
| `handlers/admin_autocard.py` | L47-206 |
| `services/ai_architect.py` | L15-201 |
| `services/card_architect.py` | L29-100 |
| `services/ai_architect.py` | L43-201 |
| `README.md` | L19-63 |
| `services/card_architect.py` | L20-100 |
| `handlers/admin_autocard.py` | L50-309 |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "/start" • 3 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\handlers\player.py` | `"""Handle /start command - register user in the game."""` | L19 |
| `.\handlers\player.py` | `"Error in /start command",` | L64 |
| `.\README.md` | `* `/start` — Реєстрація у грі.` | L60 |


</details>
</tool-use>

---



---


Reviewing the drops handler to see if it checks for user registration:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: handlers/drops.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: handlers/player.py</summary>

</details>
</tool-use>

---



---


Checking the admin autocard handler for the same behavior:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: handlers/admin_autocard.py</summary>

</details>
</tool-use>

---



---


Yes, users can get cards without using `/start`.

## Current behavior

1. Drop claims (`handlers/drops.py`): When a user claims a drop, the `_award_card_and_update_message` function automatically creates a User record if one doesn't exist:

```167:179:handlers/drops.py
            # Get or create user
            user_stmt = select(User).where(User.telegram_id == user.id)
            result = await session.execute(user_stmt)
            db_user = result.scalar_one_or_none()

            if not db_user:
                db_user = User(
                    telegram_id=user.id,
                    username=user.username,
                    balance=0,
                )
                session.add(db_user)
                await session.flush()
```

2. Admin autocard (`handlers/admin_autocard.py`): The same pattern — it creates a User record if missing when awarding a card:

```233:245:handlers/admin_autocard.py
                # Get or create target user
                user_stmt = select(User).where(User.telegram_id == target_user_id)
                result = await session.execute(user_stmt)
                db_user = result.scalar_one_or_none()

                if not db_user:
                    db_user = User(
                        telegram_id=target_user_id,
                        username=None,
                        balance=0,
                    )
                    session.add(db_user)
                    await session.flush()
```

## Summary

`/start` is informational only. Card distribution handlers auto-create users, so `/start` isn't required. If you want to enforce `/start` first, add a check in the card award functions to verify the user exists before creating them, or add a flag/validation that requires explicit registration via `/start`.

---

